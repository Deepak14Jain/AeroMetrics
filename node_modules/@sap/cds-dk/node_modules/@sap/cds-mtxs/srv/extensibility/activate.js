const cds = require('@sap/cds/lib')

const activate = async function (tenant, csvs, async) {
  if (tenant) cds.context = { tenant }

  if (async) {
    const { 'cds.xt.JobsService': js } = cds.services
    const tx = js.tx({ tenant: tenant ?? cds.context.tenant, user: new cds.User.Privileged() })
    return tx.enqueue('extend', [new Set([tenant])], [csvs])
  } else {
    const { 'cds.xt.DeploymentService': ds } = cds.services
    await ds.extend(tenant, csvs)
  }
}

module.exports = activate
